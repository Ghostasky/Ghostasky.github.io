<!DOCTYPE html>
<html lang="zh-cn" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="郁涛丶" />
  <meta name="description" content="" />
  
  
  <title>
    
      Stable Diffusion QR Code 
      
      
      |
    
     郁涛丶&#39;s Blog
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Ghostasky</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">Stable Diffusion QR Code</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2023-07-09	  
        </span>
    <span class="post-pubtime"> 本文共936字 </span>
    
    <span class="post-pubtime">大约需要5min </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="Categories"></i>
                
                <span class="span--category">
                  <a href="/categories/Technology/" title="Technology">
                    <b>#</b> Technology
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="Tags"></i>
                
                <span class="span--tag mr-8">
                  <a href="/tags/Other/" title="Other">
                    #Other
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h1 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h1><p>上个月就有看到用AI生成可扫描的二维码的文章（<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/i4WR5ULH1ZZYl8Watf3EPw">AI 生成可扫码图像 — 新 ControlNet 模型展示</a>），但是没有说具体的制作细节，当时还在reddit上搜了半天，但是制作出来的效果都差强人意。</p>
<p>昨天看到宝玉转发了一个用 Stable Diffusion 制作可扫描二维码的推特，里面有详细的制作过程，昨晚研究了下，制作出来的二维码感觉还不错。</p>
<p>先看一下上个月微信的那篇公众号里的图吧，确实很不错：</p>
<p><img src="/2023/07/09/2023-7-SDQRCode/640.jpeg" alt="图片"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/640-1688889483270-3.jpeg" alt="图片"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/640-1688889494250-6.png" alt="图片"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/640-1688889509350-9.png" alt="图片"></p>
<p>那篇公众号里有好几个图，以上是选取了几个自己觉得很好看的图。</p>
<p>好了说一下具体的制作过程吧</p>
<h1 id="制作过程"><a href="#制作过程" class="headerlink" title="制作过程"></a>制作过程</h1><p>首先是显卡，这个东西我当然是没有的，使用的云平台， <a target="_blank" rel="noopener" href="https://www.autodl.com/home">AutoDL</a> 这家，感觉很便宜了，RTX 3090 也就才不到 2 RMB/h，这里我选的是 Tesla V100-SXM2-32GB 这个GPU。</p>
<p>镜像的话用的是<code>AUTOMATIC1111/stable-diffusion-webui/NovelAI-Consolidation-Package-3.1:v10</code>这个，害其实都是 github 上那个。</p>
<p><img src="/2023/07/09/2023-7-SDQRCode/image-20230709160408658.png" alt="image-20230709160408658"></p>
<p>安装啥的就不具体说了，网上教程一堆。</p>
<p>使用了一个扩展：<a target="_blank" rel="noopener" href="https://github.com/antfu/sd-webui-qrcode-toolkit">QR Toolkit</a>，这个用来生成二维码和其他的一些操作。</p>
<p><img src="/2023/07/09/2023-7-SDQRCode/image-20230709164551543.png" alt="image-20230709164551543"></p>
<p>这里我直接是用的微信的二维码，最开始我使用纠错码是H，想着这样生成出来的图容错率更高一些，但是二维码的图size直接从29变成37了，之后生成的图效果不是很好，并且不能正确扫描识别。(这里我种子直接写的8086 :sweat_smile:)</p>
<p>对了关于扫描这块，其实我也不是很懂，网上搜了一圈发现，说是iphone的二维码识别是比Android更好的，很多图Android识别不出来，iphone就可以正确识别，这又是另一个话题了，不是很了解，过。</p>
<p>模型使用的是<a target="_blank" rel="noopener" href="https://civitai.com/models/7240/meinamix">MeinaMix</a>，ControlNetd的模型是 <a target="_blank" rel="noopener" href="https://huggingface.co/Nacholmo/controlnet-qr-pattern-v2">controlnet-qr-pattern-v2</a></p>
<p>这里有几个<a target="_blank" rel="noopener" href="https://civitai.com/models/90940">Controlnet QR Pattern</a> 的prompt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cloud, 1girl, sky, water, ocean, cloudy sky, blue eyes, blue sky, halo, window, solo, white hair, horizon, planet, constellation, day</span><br><span class="line">Negative prompt: ng_deepnegative_v1_75t, (low quality, worst quality:1.4), (bad anatomy), (inaccurate limb:1.2), bad composition, inaccurate eyes, extra digit, fewer digits, (extra arms:1.2)</span><br><span class="line">##################################################################</span><br><span class="line">a painting of a city with a river and buildings on the hillside and a sky background with clouds and snow on the ground and a blue sky, a detailed matte painting</span><br><span class="line">Negative prompt: (KHFB, AuroraNegative),(Worst Quality, Low Quality:1.4)</span><br><span class="line">##################################################################</span><br><span class="line">A mesmerizing depiction of a city ruins in the midst of a serene winter wonderland; a breathtaking photorealistic illustration capturing the essence of desolation and beauty. The scene showcases crumbling buildings blanketed in pristine snow, with delicate icicles hanging from rooftops, enhanced by the soft glow of a setting sun. The artwork exudes a sense of mystery and nostalgia, reminiscent of post-apocalyptic landscapes, evoking emotions of both solitude and awe. The level of detail is extraordinary, highlighting the intricate textures of weathered bricks, rusted metal, and the glistening ice crystals. The composition expertly balances the vastness of the abandoned cityscape with intimate close-ups of cracked windows, revealing remnants of a forgotten past. This masterpiece draws inspiration from acclaimed artists like Simon Stalenhag and Thomas Scholes, combining their distinct styles to create a truly captivating and evocative visual experience</span><br><span class="line">Negative prompt: (KHFB, AuroraNegative),(Worst Quality, Low Quality:1.4)</span><br></pre></td></tr></table></figure>

<p>其他参数的话，采样方法他们选择的是 Euler，步数使用的是30，920*920，CFG Scale是7或者8，ControlNet中Weight自我感觉1.4左右最好，起始和结束：0.05,0.96吧，没有详细调过，但是这样生成的确实不错，以下是几个我生成的图，其中有两个选择的是高纠错码，可以一眼看出来是哪两个：</p>
<p><img src="/2023/07/09/2023-7-SDQRCode/1.png" alt="1"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmp1a5q1hni.png" alt="tmp1a5q1hni"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmp7krpoyoj.png" alt="tmp7krpoyoj"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmp7wmxm7yv.png" alt="tmp7wmxm7yv"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpdstdy1am.png" alt="tmpdstdy1am"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpeucbqy5w.png" alt="tmpeucbqy5w"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpj28zjtrf.png" alt="tmpj28zjtrf"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpjmsfgv_o.png" alt="tmpjmsfgv_o"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpm5awrf33.png" alt="tmpm5awrf33"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmprllbc_27.png" alt="tmprllbc_27"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpwhgfp3t_.png" alt="tmpwhgfp3t_"></p>
<p><img src="/2023/07/09/2023-7-SDQRCode/tmpwwk5cmio.png" alt="tmpwwk5cmio"></p>
<p>差不多就这样吧，有时间更一下其他风格的，然后再详细写写其他的东西</p>
<p>ref:</p>
<p>[1] <a target="_blank" rel="noopener" href="https://github.com/antfu/sd-webui-qrcode-toolkit">https://github.com/antfu/sd-webui-qrcode-toolkit</a><br>[2] <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/i4WR5ULH1ZZYl8Watf3EPw">https://mp.weixin.qq.com/s/i4WR5ULH1ZZYl8Watf3EPw</a><br>[3] <a target="_blank" rel="noopener" href="https://twitter.com/Datou/status/1676763811360157696">https://twitter.com/Datou/status/1676763811360157696</a><br>[4] <a target="_blank" rel="noopener" href="https://antfu.me/posts/ai-qrcode">https://antfu.me/posts/ai-qrcode</a><br>[5] <a target="_blank" rel="noopener" href="https://antfu.me/posts/ai-qrcode-refine">https://antfu.me/posts/ai-qrcode-refine</a><br>[6] <a target="_blank" rel="noopener" href="https://civitai.com/models/7240/meinamix">https://civitai.com/models/7240/meinamix</a><br>[7] <a target="_blank" rel="noopener" href="https://huggingface.co/Nacholmo/controlnet-qr-pattern-v2">https://huggingface.co/Nacholmo/controlnet-qr-pattern-v2</a><br>[8] <a target="_blank" rel="noopener" href="https://civitai.com/models/90940">https://civitai.com/models/90940</a></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2023/07/03/2023-7-Win-SyscallJourney/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2023-07-09 00:00:00
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="Categories"></i>
                    
                    <span class="span--category">
                      <a href="/categories/Technology/" title="Technology">
                        <b>#</b> Technology
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="Tags"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/Other/" title="Other">
                        #Other
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2023/07/10/2023-7-LinuxSourceRead/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%B7%E6%BA%90"><span class="toc-text">起源</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-text">制作过程</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/Ghostasky">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" target="_blank" rel="noopener" href="https://twitter.com/ghostasky">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/Ghostasky">怕什么真理无穷，进一寸有进一寸的欢喜。</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2023 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + Stable%20Diffusion%20QR%20Code + '&url=' + https%3A%2F%2Fghostasky.github.io%2F2023%2F07%2F09%2F2023-7-SDQRCode%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://ghostasky.github.io/2023/07/09/2023-7-SDQRCode/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
